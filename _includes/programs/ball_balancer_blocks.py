# pybricks blocks file:{"blocks":{"languageVersion":0,"blocks":[{"type":"blockGlobalSetup","id":"bjK,wS1MYO7aiYkFSwd{","x":60,"y":58,"deletable":false,"next":{"block":{"type":"variables_set_motor","id":"N`TYqbiTjFBd%!Vt[7hh","fields":{"VAR":{"id":"5=km/}K26/FGs{EuF|qL"}},"inputs":{"PORT":{"shadow":{"type":"blockParametersPort","id":"U`Y_Ml/jKeeC%BCCWKu-","fields":{"NAME":"B"}}},"POSITIVE_DIRECTION":{"shadow":{"type":"blockParametersDirection","id":";7g=7Ny:/bw_o3~WZ+;O","fields":{"SELECTION":"Direction.COUNTERCLOCKWISE"}}}},"next":{"block":{"type":"variables_set_motor","id":"S`8gNl;!kq/X`C]3.^T}","fields":{"VAR":{"id":"+IwjC:P:uK9a[62C5Tg["}},"inputs":{"PORT":{"shadow":{"type":"blockParametersPort","id":"ZGRZEO]rp!l[tH8Ru{HQ","fields":{"NAME":"F"}}},"POSITIVE_DIRECTION":{"shadow":{"type":"blockParametersDirection","id":"e|a.T{ARu2blr@_=xf@Y","fields":{"SELECTION":"Direction.COUNTERCLOCKWISE"}}}},"next":{"block":{"type":"variables_set_inventor_hub","id":"JkSo^{Fc@9Lk_pU%yRN:","extraState":{"optionLevel":1},"fields":{"VAR":{"id":"YFlm)awsT,bD8]`GU|#8"}},"inputs":{"AXIS_TOP":{"shadow":{"type":"blockParametersAxis","id":"sR*]zm2GYEUu={}20hpW","fields":{"VALUE":"z"}},"block":{"type":"blockVector","id":"e_A(e}M=337TjEtG8o5:","inputs":{"X":{"shadow":{"type":"blockMathNumber","id":"6}ZrsD%o4a%Cm]~];NXA","fields":{"NUM":1}}},"Y":{"shadow":{"type":"blockMathNumber","id":"VwZ_t+K)}/EgudgHl?,6","fields":{"NUM":1}}},"Z":{"shadow":{"type":"blockMathNumber","id":"5.OnB-.*^`tI,3RtCZii","fields":{"NUM":0}}}}}},"AXIS_FRONT":{"shadow":{"type":"blockParametersAxis","id":"[EfzH-;=ST4IRz!?W*kn","fields":{"VALUE":"x"}},"block":{"type":"blockVector","id":"IKPZA[E`V2.-KwF(g[f3","inputs":{"X":{"shadow":{"type":"blockMathNumber","id":"}n#-6qRY`{[NJ^;{gdOO","fields":{"NUM":-1}}},"Y":{"shadow":{"type":"blockMathNumber","id":"sYhRrTU$zXMV@LmuHB7e","fields":{"NUM":1}}},"Z":{"shadow":{"type":"blockMathNumber","id":"CONz=IvN-h~]bv[pct0!","fields":{"NUM":0}}}}}}},"next":{"block":{"type":"variables_setup_any","id":"rW~q^#%;S{R+B3l_AT(N","fields":{"VAR":{"id":"Q5%oho`u~;@dQzJb2^T:"}},"inputs":{"VALUE0":{"shadow":{"type":"blockMathNumber","id":"{_+Z:u!L`|=/mLc/2^t)","fields":{"NUM":0}},"block":{"type":"blockImuRotation","id":"tO~!k?f?c/(]68BK8fSo","extraState":{"optionLevel":0},"fields":{"METHOD":"IMU_GET_ROTATION"},"inputs":{"VAR":{"shadow":{"type":"variables_get_imu_hub","id":"UV6Fm[exWM-*Hj}O3x#k","fields":{"VAR":{"id":"YFlm)awsT,bD8]`GU|#8","name":"hub","type":"InventorHub"}}}},"VALUE0":{"shadow":{"type":"blockParametersAxis","id":"DX8C%C7Q)3^ziaids94Z","fields":{"VALUE":"x"}}}}}}},"next":{"block":{"type":"variables_setup_any","id":"oPe0{)Yl{aDB;+FbHA^l","fields":{"VAR":{"id":"ExkrMgQXWU`J1P|{^nL["}},"inputs":{"VALUE0":{"shadow":{"type":"blockMathNumber","id":"{_+Z:u!L`|=/mLc/2^t)","fields":{"NUM":0}},"block":{"type":"blockImuRotation","id":"=4R%qk#utheDa+9$%4q`","extraState":{"optionLevel":0},"fields":{"METHOD":"IMU_GET_ROTATION"},"inputs":{"VAR":{"shadow":{"type":"variables_get_imu_hub","id":"-$(hn,LG^R;@H~L/=lSE","fields":{"VAR":{"id":"YFlm)awsT,bD8]`GU|#8","name":"hub","type":"InventorHub"}}}},"VALUE0":{"shadow":{"type":"blockParametersAxis","id":"SfBsU370@B6|7;FK(`-~","fields":{"VALUE":"y"}}}}}}}}}}}}}}}}}},{"type":"blockGlobalStart","id":"3tJe|AWl0baN(wH9a$@.","x":58,"y":397,"deletable":false,"next":{"block":{"type":"blockComment","id":"1De:%ygA#]LvF}OOk2_9","fields":{"FIELDNAME":"Check that the hub gyro is ready for use."},"next":{"block":{"type":"blockIfElse","id":"Wrh.MEC?D=$un9r~yVey","extraState":{"optionLevel":0},"inputs":{"IF0":{"shadow":{"type":"blockLogicTrue","id":"6DaIl]R4_{Q4l5Z7UnE!"},"block":{"type":"blockLogicIsNone","id":"N[|p]wAi!0g/SxL8qL4X","fields":{"OP":"NOT"},"inputs":{"BOOL":{"shadow":{"type":"blockLogicTrue","id":"q}pzJYT]s}JaO3u)l1Js"},"block":{"type":"blockImuStatus","id":"9mjfp!|zA4$ZOcj9fgog","extraState":{"optionLevel":0},"fields":{"METHOD":"IMU_GET_READY"},"inputs":{"VAR":{"shadow":{"type":"variables_get_imu_hub","id":"(_:oH#OofvHMJMpfNY-w","fields":{"VAR":{"id":"YFlm)awsT,bD8]`GU|#8","name":"hub","type":"InventorHub"}}}}}}}}}},"DO0":{"block":{"type":"blockSpeakerBeep","id":"CEs%q5a/5g;#~gd$,a7;","inputs":{"VAR":{"shadow":{"type":"variables_get_speaker_hub","id":"!#T4U#n9sqwZM.pjhyev","fields":{"VAR":{"id":"YFlm)awsT,bD8]`GU|#8","name":"hub","type":"InventorHub"}}}},"VALUE0":{"shadow":{"type":"unit_frequency","id":"*0Ed[{gjKBm(7@Kge@y^","fields":{"VALUE0":500}}},"VALUE1":{"shadow":{"type":"unit_time","id":"P!slQGa~xPV~j2Kxpj8q","fields":{"VALUE0":100}}}},"next":{"block":{"type":"blockProgramStop","id":"VeIy`}7c4Xg|O*#qKojP"}}}}},"next":{"block":{"type":"blockMotorResetAngle","id":"/Yp*WFBzt)GCg%DdTNWj","inputs":{"VAR":{"shadow":{"type":"variables_get_motor_device","id":"|J-~1l2(1-BYqkTVVbP^","fields":{"VAR":{"id":"5=km/}K26/FGs{EuF|qL","name":"motor x","type":"Motor"}}}},"VALUE0":{"shadow":{"type":"unit_angle","id":"QXc!ctR#LT[,`5Rkwwvh","fields":{"VALUE0":0}}}},"next":{"block":{"type":"blockMotorResetAngle","id":"Ba^v9Rer[J%6a!|-uYQa","inputs":{"VAR":{"shadow":{"type":"variables_get_motor_device","id":"SMF`H:pyHvpYfU.jdVs8","fields":{"VAR":{"id":"+IwjC:P:uK9a[62C5Tg[","name":"motor y","type":"Motor"}}}},"VALUE0":{"shadow":{"type":"unit_angle","id":"cxExjECS8eNB+aD*jrYC","fields":{"VALUE0":0}}}},"next":{"block":{"type":"blockComment","id":"0VFarX:s0=~|HBFX81OL","fields":{"FIELDNAME":"Keep balancing forever."},"next":{"block":{"type":"blockFlowWhile","id":"xRO%RB|bM((kk{a5q@//","fields":{"MODE":"WHILE"},"inputs":{"BOOL":{"shadow":{"type":"blockLogicTrue","id":"}MFvD)x([SZg1D^rd}-{"}},"DO":{"block":{"type":"blockFunctionCallerStatement","id":"g_U^w0$u2%ty|~$H+.P-","extraState":{"optionLevel":4},"fields":{"ICON":"TASK","VAR":{"id":"AL][=sHdfRJjkw]@#tQu"}},"inputs":{"ARG0":{"shadow":{"type":"blockMathNumber","id":"L@q*QES6mXY{#qv~6H~U","fields":{"NUM":0}},"block":{"type":"blockreadOnlyGetter","id":"/Qnxs{!x`q:A4!|1j`xp","fields":{"VAR":{"id":"5=km/}K26/FGs{EuF|qL"}}}},"ARG1":{"shadow":{"type":"blockMathNumber","id":"Lw:QrjU#,`^wO(+LM~Na","fields":{"NUM":0}},"block":{"type":"blockVector","id":"zb4ce@*JY!;K9Q)_+u`-","inputs":{"X":{"shadow":{"type":"blockMathNumber","id":"0R?uBL(H%]^/ccgW-[xQ","fields":{"NUM":1}}},"Y":{"shadow":{"type":"blockMathNumber","id":"pcw_[HzulmA/#mMFBZck","fields":{"NUM":0}}},"Z":{"shadow":{"type":"blockMathNumber","id":"Jo!G.9JKz%2hWX]SEb.Q","fields":{"NUM":0}}}}}},"ARG2":{"shadow":{"type":"blockMathNumber","id":"f1[GZtdd]ph=K8#=u1HC","fields":{"NUM":0}},"block":{"type":"blockVariableGetValue","id":"MBlSIBVRP3z5r`_00Uj}","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"NXr.hUmbD_Jygk.X5nyM","fields":{"VAR":{"id":"Q5%oho`u~;@dQzJb2^T:","name":"start angle x","type":"Any"}}}}}}},"ARG3":{"shadow":{"type":"blockMathNumber","id":"1_8uGA7n$j8vFKr|DWgx","fields":{"NUM":0}}}},"next":{"block":{"type":"blockFunctionCallerStatement","id":"supna||2ShY@/Xzh7[GN","extraState":{"optionLevel":4},"fields":{"ICON":"TASK","VAR":{"id":"AL][=sHdfRJjkw]@#tQu"}},"inputs":{"ARG0":{"shadow":{"type":"blockMathNumber","id":"L@q*QES6mXY{#qv~6H~U","fields":{"NUM":0}},"block":{"type":"blockreadOnlyGetter","id":"::w-@WgN[bI{q*Bk!iVN","fields":{"VAR":{"id":"+IwjC:P:uK9a[62C5Tg["}}}},"ARG1":{"shadow":{"type":"blockMathNumber","id":"Lw:QrjU#,`^wO(+LM~Na","fields":{"NUM":0}},"block":{"type":"blockVector","id":"(CO[4!!5U@hR-w=f_@MO","inputs":{"X":{"shadow":{"type":"blockMathNumber","id":"T)/8q:v*91CM^mKzz@wi","fields":{"NUM":0}}},"Y":{"shadow":{"type":"blockMathNumber","id":"E#q~yEdNulX^)8%94*HI","fields":{"NUM":1}}},"Z":{"shadow":{"type":"blockMathNumber","id":"q{DY!KcWWSjW}D$rb*G9","fields":{"NUM":0}}}}}},"ARG2":{"shadow":{"type":"blockMathNumber","id":"f1[GZtdd]ph=K8#=u1HC","fields":{"NUM":0}},"block":{"type":"blockVariableGetValue","id":":b9RIzg8{/F,tV9aja-@","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"2Kk9oD^gnN0Az+4kTDZ;","fields":{"VAR":{"id":"ExkrMgQXWU`J1P|{^nL[","name":"start angle y","type":"Any"}}}}}}},"ARG3":{"shadow":{"type":"blockMathNumber","id":"1?S-8lQB#Z9;FR`|EIM+","fields":{"NUM":0}}}},"next":{"block":{"type":"blockWaitTime","id":"A679d$|f(t;E6x[`+4PA","inputs":{"VALUE0":{"shadow":{"type":"unit_time","id":"Ez?*s.|n{zhNGE0=D/b%","fields":{"VALUE0":10}}}}}}}}}}}}}}}}}}}}}}}},{"type":"variables_setup_function","id":"Y$fB@K~%.,Z)j_#;Ts]H","x":56,"y":1084,"extraState":{"optionLevel":4},"fields":{"ICON":"TASK","VAR":{"id":"AL][=sHdfRJjkw]@#tQu"}},"inputs":{"ARG0":{"shadow":{"type":"variables_setup_function_argument","id":"n%uBP.Aq!L!t2!GiF}6k","fields":{"VAR":{"id":"MHpV!2`!yNcLu+y+Mrz{","name":"motor","type":"FunctionArgument"}}}},"ARG1":{"shadow":{"type":"variables_setup_function_argument","id":"UBF*1O^m-Fi@r8`n|dAH","fields":{"VAR":{"id":"R%]q)a(lZy6UUO2mp7lh","name":"axis","type":"FunctionArgument"}}}},"ARG2":{"shadow":{"type":"variables_setup_function_argument","id":"EJT(JGp.Y#E0F#Sc=qQ{","fields":{"VAR":{"id":"_nS@IsPh3$(DP`)%G`Mf","name":"start angle","type":"FunctionArgument"}}}},"ARG3":{"shadow":{"type":"variables_setup_function_argument","id":"NXTv?e^xQ_|3fGv+bCud","fields":{"VAR":{"id":"?b:cTc/0w%mSA[!HKV*~","name":"duty","type":"FunctionArgument"}}}},"STACK":{"block":{"type":"blockComment","id":"d0*p@qFB4Pfeeu7fx6I(","fields":{"FIELDNAME":"The feedback to the motor is a weighted sum of the gyro angle,\ngyro angular velocity, motor angle, and motor speed."},"next":{"block":{"type":"blockVariableSetValue","id":"S#w/XRMMQ]*3v^N1|HMX","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"^P0NZ,lX,ElkcTVLWRE|","fields":{"VAR":{"id":"Q5%oho`u~;@dQzJb2^T:","name":"start angle x","type":"Any"}}},"block":{"type":"variables_setup_function_argumentConstant","id":"/DRY-+6]YY-T@5-!i/3H","fields":{"VAR":{"text":"duty"}}}},"VALUE0":{"shadow":{"type":"blockMathNumber","id":"jdd:$+2H,8{c%NS.$zMX","fields":{"NUM":0}},"block":{"type":"blockMathFormula","id":"p)yeYJZv5F3cI6)Wty]b","inline":false,"extraState":{"optionLevel":4},"fields":{"FORMULA":"88 * a + 0.35 * b + 0.72 * c + 0.19 * d"},"inputs":{"a":{"shadow":{"type":"blockMathNumber","id":"w[$z7n+gX,}g4uL=RCgH","fields":{"NUM":0}},"block":{"type":"blockMathArithmetic","id":"Jfjn?0IXVT+5D9GO%O5I","fields":{"OP":"MINUS"},"inputs":{"A":{"shadow":{"type":"blockMathNumber","id":"A0Bgr=vt7#vb~T/iL2)r","fields":{"NUM":1}},"block":{"type":"blockImuRotation","id":"0?G-DkKU$yUSkI[tjxnj","extraState":{"optionLevel":0},"fields":{"METHOD":"IMU_GET_ROTATION"},"inputs":{"VAR":{"shadow":{"type":"variables_get_imu_hub","id":"e0YJ-LH6/x0t87dM-Kwg","fields":{"VAR":{"id":"YFlm)awsT,bD8]`GU|#8","name":"hub","type":"InventorHub"}}}},"VALUE0":{"shadow":{"type":"blockParametersAxis","id":"P59!QkKMZ[@#wh4GzHow","fields":{"VALUE":"y"}},"block":{"type":"variables_setup_function_argumentConstant","id":"DTNsh0/T,aQ%5$}m[61K","fields":{"VAR":{"text":"axis"}}}}}}},"B":{"shadow":{"type":"blockMathNumber","id":"}nbcMf7@W3Vp~ba#.ZEG","fields":{"NUM":1}},"block":{"type":"variables_setup_function_argumentConstant","id":"f}{-v:@Y:hFk9?f62T!u","fields":{"VAR":{"text":"start angle"}}}}}}},"b":{"shadow":{"type":"blockMathNumber","id":"{tW:+[@Qs.Jc}|wWR_)~","fields":{"NUM":0}},"block":{"type":"blockImuRotation","id":"_%3hmF8qu#Iexv;D*3u=","extraState":{"optionLevel":0},"fields":{"METHOD":"IMU_GET_ANGULAR_VELOCITY"},"inputs":{"VAR":{"shadow":{"type":"variables_get_imu_hub","id":"{rp7Jv=RK!3A|Ys[UFBy","fields":{"VAR":{"id":"YFlm)awsT,bD8]`GU|#8","name":"hub","type":"InventorHub"}}}},"VALUE0":{"shadow":{"type":"blockParametersAxis","id":"7{P0ZITQ*^_0E(Uiu|gF","fields":{"VALUE":"y"}},"block":{"type":"variables_setup_function_argumentConstant","id":"%oKq4u~]5NMAmGOdFHY*","fields":{"VAR":{"text":"axis"}}}}}}},"c":{"shadow":{"type":"blockMathNumber","id":"?SBu9-pw;v[EJR%8o$32","fields":{"NUM":0}},"block":{"type":"blockMotorMeasure","id":"}[DQd3AH/VxwrC_QWkf?","extraState":{"optionLevel":1},"fields":{"METHOD":"MOTOR_ANGLE"},"inputs":{"VAR":{"shadow":{"type":"variables_get_motor_device","id":"3KibpzZ8I}=(2%t{4Qg)","fields":{"VAR":{"id":"+IwjC:P:uK9a[62C5Tg[","name":"motor y","type":"Motor"}}},"block":{"type":"variables_setup_function_argumentConstant","id":"(V-L[fc!}7H(#P^g#!h?","fields":{"VAR":{"text":"motor"}}}}}}},"d":{"shadow":{"type":"blockMathNumber","id":"uEI-.KRvn}RZ1yt=MYvJ","fields":{"NUM":0}},"block":{"type":"blockMotorMeasure","id":"V;YULYRxBH(IUB2=;A,;","extraState":{"optionLevel":3},"fields":{"METHOD":"MOTOR_GET_SPEED_AVERAGE"},"inputs":{"VAR":{"shadow":{"type":"variables_get_motor_device","id":"7=B5=M8P)~b(SSb*}eY1","fields":{"VAR":{"id":"+IwjC:P:uK9a[62C5Tg[","name":"motor y","type":"Motor"}}},"block":{"type":"variables_setup_function_argumentConstant","id":"b`Z(Jg8+lH,+gi=:NRm-","fields":{"VAR":{"text":"motor"}}}},"ARG0":{"shadow":{"type":"unit_time","id":"sR[(@DP3;6/5AeX~8=(t","fields":{"VALUE0":250}}}}}}}}}},"next":{"block":{"type":"blockComment","id":"-LoPGsw:OdfED;!e^+Y!","fields":{"FIELDNAME":"The feedback value is applied to the motor. We also add 10% extra\nto account for friction. The result is scaled by the battery level so it\nbehaves the same over time."},"next":{"block":{"type":"blockMotorDuty","id":"5-+WI.=rARB}m12/oeHs","inputs":{"VAR":{"shadow":{"type":"variables_get_simple_motor_device","id":"6]!,f^7L8D2}_k{C?^K%","fields":{"VAR":{"id":"+IwjC:P:uK9a[62C5Tg[","name":"motor y","type":"Motor"}}},"block":{"type":"variables_setup_function_argumentConstant","id":"Nhpf4OKnIb,K=sUb#aD]","fields":{"VAR":{"text":"motor"}}}},"VALUE0":{"shadow":{"type":"unit_percent","id":"B6gx_m=!DAZ%Eb|xqYOu","fields":{"VALUE0":50}},"block":{"type":"blockMathFormula","id":"z[uVL?ejVJU*~GVaXA_-","extraState":{"optionLevel":2},"fields":{"FORMULA":"(a + copysign(10, a)) * 7400 / b"},"inputs":{"a":{"shadow":{"type":"blockMathNumber","id":"w[$z7n+gX,}g4uL=RCgH","fields":{"NUM":0}},"block":{"type":"variables_setup_function_argumentConstant","id":"vlp(Q*^#y-C3Ybjv{YHr","fields":{"VAR":{"text":"duty"}}}},"b":{"shadow":{"type":"blockMathNumber","id":"6*}W2c/~;Y9*Nc;zx]|-","fields":{"NUM":0}},"block":{"type":"blockBatteryMeasure","id":"S=[A}eLTDw%EUStZn3!x","extraState":{"optionLevel":0},"fields":{"METHOD":"BATTERY_GET_VOLTAGE"},"inputs":{"VAR":{"shadow":{"type":"variables_get_battery_hub","id":"Emu,iclp2[E*QWCIm@5u","fields":{"VAR":{"id":"YFlm)awsT,bD8]`GU|#8","name":"hub","type":"InventorHub"}}}}}}}}}}}}}}}}}}}}}]},"variables":[{"name":"red","id":"LQu[N~vu.sNRg`M`]1{C","type":"ColorDef"},{"name":"orange","id":"yW`r%uz+JSP5(N#5~[@N","type":"ColorDef"},{"name":"yellow","id":"MibTlQ)y4=E.4Hct5W;h","type":"ColorDef"},{"name":"green","id":"oJ?bO;{[|ram@b[B(iO~","type":"ColorDef"},{"name":"cyan","id":"3u;XBHP4A.Kj5m$sqi=v","type":"ColorDef"},{"name":"blue","id":"H^0ke8b{|[En[]k|01V#","type":"ColorDef"},{"name":"violet","id":"k4{(vJ(s3!m(B9eS`b*h","type":"ColorDef"},{"name":"magenta","id":"uq!$GZW~BR4mhd:?l?j5","type":"ColorDef"},{"name":"white","id":"rR4UOdCGJ]vf4ms(i`lG","type":"ColorDef"},{"name":"none","id":"V%jF3u,XAQ(.5uyB,%1b","type":"ColorDef"},{"name":"motor x","id":"5=km/}K26/FGs{EuF|qL","type":"Motor"},{"name":"motor y","id":"+IwjC:P:uK9a[62C5Tg[","type":"Motor"},{"name":"hub","id":"YFlm)awsT,bD8]`GU|#8","type":"InventorHub"},{"name":"motor","id":"MHpV!2`!yNcLu+y+Mrz{","type":"FunctionArgument"},{"name":"axis","id":"R%]q)a(lZy6UUO2mp7lh","type":"FunctionArgument"},{"name":"start angle","id":"_nS@IsPh3$(DP`)%G`Mf","type":"FunctionArgument"},{"name":"duty","id":"?b:cTc/0w%mSA[!HKV*~","type":"FunctionArgument"},{"name":"start angle x","id":"Q5%oho`u~;@dQzJb2^T:","type":"Any"},{"name":"start angle y","id":"ExkrMgQXWU`J1P|{^nL[","type":"Any"},{"name":"balance","id":"AL][=sHdfRJjkw]@#tQu","type":"Function"}],"info":{"type":"pybricks","version":"1.2.3"}}
from pybricks.hubs import InventorHub
from pybricks.parameters import Axis, Direction, Port
from pybricks.pupdevices import Motor
from pybricks.tools import vector, wait
from umath import copysign

# Set up all devices.
hub = InventorHub(top_side=vector(1, 1, 0), front_side=vector(-1, 1, 0))
motor_x = Motor(Port.B, Direction.COUNTERCLOCKWISE)
motor_y = Motor(Port.F, Direction.COUNTERCLOCKWISE)

# Initialize variables.
start_angle_x = hub.imu.rotation(Axis.X)
start_angle_y = hub.imu.rotation(Axis.Y)

def balance(motor, axis, start_angle, duty):
    # The feedback to the motor is a weighted sum of the gyro angle,
    # gyro angular velocity, motor angle, and motor speed.
    duty = 88 * (hub.imu.rotation(axis) - start_angle) + hub.imu.angular_velocity(axis) * 7 / 20 + motor.angle() * 18 / 25 + motor.speed(window=250) * 19 / 100
    # The feedback value is applied to the motor. We also add 10% extra
    # to account for friction. The result is scaled by the battery level so it
    # behaves the same over time.
    motor.dc(7400 * (duty + copysign(10, duty)) / hub.battery.voltage())


# The main program starts here.
# Check that the hub gyro is ready for use.
if not hub.imu.ready():
    hub.speaker.beep(500, 100)
    raise SystemExit
motor_x.reset_angle(0)
motor_y.reset_angle(0)
# Keep balancing forever.
while True:
    balance(motor_x, vector(1, 0, 0), start_angle_x, 0)
    balance(motor_y, vector(0, 1, 0), start_angle_y, 0)
    wait(10)
