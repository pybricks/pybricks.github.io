# pybricks blocks file:{"blocks":{"languageVersion":0,"blocks":[{"type":"blockGlobalSetup","id":"bjK,wS1MYO7aiYkFSwd{","x":16,"y":-8,"deletable":false,"next":{"block":{"type":"variables_set_essential_hub","id":"GP+44UVc^49ZnGkZ$s7C","extraState":{"optionLevel":0},"fields":{"VAR":{"id":"9n@^uaL3hZ06|6JvH*6N"}},"next":{"block":{"type":"variables_setup_imported_function","id":"giC/s|xX/K+.WCijR:zo","fields":{"FROM_MODULE":{"id":"675Tewb-hZRNskTpaPR^"},"VAR":{"id":"Sffa}}200*Q_|`ua!5IE"}},"next":{"block":{"type":"variables_setup_imported_function","id":"=}XV0~`:H4uDYYfl-:pP","fields":{"FROM_MODULE":{"id":"675Tewb-hZRNskTpaPR^"},"VAR":{"id":"NdzekE#*A-3^u{=XF,9y"}},"next":{"block":{"type":"variables_setup_imported_function","id":"$N9wYz5Ei.nBnb!s-E4`","fields":{"FROM_MODULE":{"id":"675Tewb-hZRNskTpaPR^"},"VAR":{"id":"InaCEX!Wvubx{)h9ua7L"}},"next":{"block":{"type":"variables_setup_imported_function","id":"9de-bU,Q93MJsx-Ws-@H","fields":{"FROM_MODULE":{"id":"675Tewb-hZRNskTpaPR^"},"VAR":{"id":"H)(CPxdW.NkK~=wz;ku{"}},"next":{"block":{"type":"variables_setup_any","id":".i]KE~yO`yx2nb$dJ^UD","fields":{"VAR":{"id":"7)~un:z)5e}=.]Wk?bCp"}},"inputs":{"VALUE0":{"shadow":{"type":"blockMathNumber","id":"kRDg[]2Jjl/I7$iGo{u;","fields":{"NUM":0}},"block":{"type":"blockImportTaskCallValue","id":"WbkBvd[VGI-zG7LbS$ub","extraState":{"optionLevel":0},"inputs":{"VAR":{"shadow":{"type":"variables_get_imported_function","id":"g,noa/6jb8V.:Da5`;2c","fields":{"VAR":{"id":"Sffa}}200*Q_|`ua!5IE","name":"DuploTrain","type":"FunctionImported"}}}}}}}},"next":{"block":{"type":"variables_set_motor","id":"fEi2x[#OqUMq5sguv5Z@","fields":{"VAR":{"id":"A%Q4I{Fw1}[HZ25D/7sC"}},"inputs":{"PORT":{"shadow":{"type":"blockParametersPort","id":"kEO(A/bs@Lb*g_AUK5=V","fields":{"NAME":"A"}}},"POSITIVE_DIRECTION":{"shadow":{"type":"blockParametersDirection","id":"kTOtk9n{hKY+nkHvu?-9","fields":{"SELECTION":"Direction.CLOCKWISE"}}}},"next":{"block":{"type":"variables_set_color_sensor","id":"c4VL[.L{UcjlqM%/+444","extraState":{"optionLevel":0},"fields":{"VAR":{"id":"@XZHI/7H?CTN~buGAy24"}},"inputs":{"PORT":{"shadow":{"type":"blockParametersPort","id":"^M]_hxv]hYHjrInqKNyu","fields":{"NAME":"B"}}}},"next":{"block":{"type":"variables_setup_any","id":"xZ=xm5c$ni1qJiu))M;R","fields":{"VAR":{"id":"TE4wo///`0hS0R{cxKph"}},"inputs":{"VALUE0":{"shadow":{"type":"blockMathNumber","id":"/9!vjomG]9jBNf*^R9yi","fields":{"NUM":0}},"block":{"type":"variables_get_color","id":"bhS6p](@/d$]^Nq+/@{i","fields":{"COLOUR":"#000000","VAR":{"id":"TFmFW?).wKf=+rwisHES"}}}}},"next":{"block":{"type":"variables_setup_any","id":":z^;f3A`sL0$!(3*8!w)","fields":{"VAR":{"id":"zU|zw|^jx16lQDrMxQ!}"}},"inputs":{"VALUE0":{"shadow":{"type":"blockMathNumber","id":"Ag*vwn/;3P0FH0tk[|BM","fields":{"NUM":0}},"block":{"type":"variables_get_color","id":"WK|V^Sv}S)wUy(EN;0.6","fields":{"COLOUR":"#000000","VAR":{"id":"TFmFW?).wKf=+rwisHES"}}}}}}}}}}}}}}}}}}}}}}}}}},{"type":"blockGlobalStart","id":"3tJe|AWl0baN(wH9a$@.","x":19,"y":539,"deletable":false,"next":{"block":{"type":"blockComment","id":"cE%o[V2hg4*n#9aiXhHx","fields":{"FIELDNAME":"My youngest would often press the hub button. This\nnormally stops the program, so it interrupts the fun\nof just playing and independently exploring.\n\nThis block disables that, so the program doesn't stop.\nIf you do want to stop eventually, just hold the button\nto turn the hub off entirely, as you normally would."},"next":{"block":{"type":"blockHubStopButton","id":"hcI!/Ho0c.Dcq=lU`rrq","inputs":{"VAR":{"shadow":{"type":"variables_get_button_hub","id":"H.D:DDKpPt1URrl`G/wf","fields":{"VAR":{"id":"9n@^uaL3hZ06|6JvH*6N","name":"hub","type":"EssentialHub"}}}},"VALUE0":{"shadow":{"type":"blockParametersButton","id":",~Vh82WirQz;@W9Sn.BF","fields":{"VALUE":"CENTER"}},"block":{"type":"blockNone","id":"aRd6n+3h.4J_n+?o/SIl"}}},"next":{"block":{"type":"blockFlowWhile","id":"kNA3Ql:gd,YZ~o`U3HFf","fields":{"MODE":"WHILE"},"inputs":{"BOOL":{"shadow":{"type":"blockLogicTrue","id":"~PrquIN`#DE76x;sQT,-"}},"DO":{"block":{"type":"blockComment","id":"_B]B5L(Tv|hS7!yHK^rb","fields":{"FIELDNAME":"Set the train speed based on the motor angle."},"next":{"block":{"type":"blockImportTaskCallStatement","id":"?d_^.Nlq_c]::q7V{KIz","extraState":{"optionLevel":2},"inputs":{"VAR":{"shadow":{"type":"variables_get_imported_function","id":"dVbN@gwIxP7;89X-.y,5","fields":{"VAR":{"id":"NdzekE#*A-3^u{=XF,9y","name":"start_driving","type":"FunctionImported"}}}},"ARG0":{"shadow":{"type":"blockMathNumber","id":"]5lS8{~;tRFE{simAu2c","fields":{"NUM":0}},"block":{"type":"blockVariableGetValue","id":"$Z9-RoAZ@-X)XvEHA8Yl","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"188iblNXCJ}oVeq=gsl@","fields":{"VAR":{"id":"7)~un:z)5e}=.]Wk?bCp","name":"train","type":"Any"}}}}}}},"ARG1":{"shadow":{"type":"blockMathNumber","id":"`BBF3}YHJAf[ME7lknWP","fields":{"NUM":0}},"block":{"type":"blockMotorMeasure","id":"v(MsO;0F/c%4Xx)Uz3`A","extraState":{"optionLevel":1},"fields":{"METHOD":"MOTOR_ANGLE"},"inputs":{"VAR":{"shadow":{"type":"variables_get_motor_device","id":"Y1SL3[?DJUfr.m#yv.!u","fields":{"VAR":{"id":"A%Q4I{Fw1}[HZ25D/7sC","name":"dial","type":"Motor"}}}}}}}},"next":{"block":{"type":"blockComment","id":"n!`Udyoz]2%#^hTAX-K-","fields":{"FIELDNAME":"Detect colored bricks. Use it to update the duplo light and sound."},"next":{"block":{"type":"blockVariableSetValue","id":"TDq$l0#nYC{LR7Hn}@~W","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"DE6ob,07kFDsf.du_*)D","fields":{"VAR":{"id":"zU|zw|^jx16lQDrMxQ!}","name":"current color","type":"Any"}}}},"VALUE0":{"shadow":{"type":"blockMathNumber","id":"/JAYKeF3K;u/uWU/(^N_","fields":{"NUM":0}},"block":{"type":"blockColor","id":"dc5KtZ,_uV9!(fEJP3@S","extraState":{"optionLevel":0},"fields":{"METHOD":"COLOR_GET_COLOR"},"inputs":{"VAR":{"shadow":{"type":"variables_get_color_device","id":"WT_-@hBcr.iId(ZLUi[Q","fields":{"VAR":{"id":"@XZHI/7H?CTN~buGAy24","name":"color sensor","type":"ColorSensor"}}}}}}}},"next":{"block":{"type":"blockComment","id":"|H8@,Iq[Z4sXFx1]k{*_","fields":{"FIELDNAME":"Do something only if the color changed."},"next":{"block":{"type":"blockIfElse","id":"h.?N2ae6~U%bck*W_emH","extraState":{"optionLevel":0},"inputs":{"IF0":{"shadow":{"type":"blockLogicTrue","id":"#CNcrihgWB]?HVAv08rX"},"block":{"type":"blockLogicCompare","id":"Im;@Q2.^G2p;E-mvx52t","fields":{"OP1":"NEQ"},"inputs":{"A":{"shadow":{"type":"blockMathNumber","id":"]*PPh/r9`~~q3N;a|!`R","fields":{"NUM":3}},"block":{"type":"blockVariableGetValue","id":"fUkZrF_jsh(J#x:,oG0t","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"F:6;7``lT?_-BZ2*rAY_","fields":{"VAR":{"id":"zU|zw|^jx16lQDrMxQ!}","name":"current color","type":"Any"}}}}}}},"B":{"shadow":{"type":"blockMathNumber","id":"$V3}G[O02vmu?#KZ`mWY","fields":{"NUM":4}},"block":{"type":"blockVariableGetValue","id":"%u[;7v`8U2m}z]is$A5f","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"y?ovpSE,Ek)WbEf7]9ri","fields":{"VAR":{"id":"TE4wo///`0hS0R{cxKph","name":"last color","type":"Any"}}}}}}}}}},"DO0":{"block":{"type":"blockComment","id":",#,at`j+``_3-Acgg,}4","fields":{"FIELDNAME":"If there is any color (not none), sound the horn."},"next":{"block":{"type":"blockIfElse","id":"*+}(zy,[gPtUx*Tgf{a7","extraState":{"optionLevel":0},"inputs":{"IF0":{"shadow":{"type":"blockLogicTrue","id":"wLvbOxGLR{-:+L~5d64("},"block":{"type":"blockLogicCompare","id":"ykJziB!.cC@X^IT;-GIl","fields":{"OP1":"NEQ"},"inputs":{"A":{"shadow":{"type":"blockMathNumber","id":"]*PPh/r9`~~q3N;a|!`R","fields":{"NUM":3}},"block":{"type":"blockVariableGetValue","id":"_P$B4@NbR@,YFb[KCzl=","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"**O/+2fo3kuy0LMcSyB@","fields":{"VAR":{"id":"zU|zw|^jx16lQDrMxQ!}","name":"current color","type":"Any"}}}}}}},"B":{"shadow":{"type":"blockMathNumber","id":"$V3}G[O02vmu?#KZ`mWY","fields":{"NUM":4}},"block":{"type":"variables_get_color","id":"oF^Lw7cgfwdi#_2L3/EK","fields":{"COLOUR":"#000000","VAR":{"id":"TFmFW?).wKf=+rwisHES"}}}}}}},"DO0":{"block":{"type":"blockImportTaskCallStatement","id":"Vj9lAHq%?q*9?SRCS%sJ","extraState":{"optionLevel":2},"inputs":{"VAR":{"shadow":{"type":"variables_get_imported_function","id":"*H.QjBF/rJTbj~+@v{0|","fields":{"VAR":{"id":"InaCEX!Wvubx{)h9ua7L","name":"play_sound","type":"FunctionImported"}}}},"ARG0":{"shadow":{"type":"blockMathNumber","id":"e|87I,cMCG3/a?#7g|qT","fields":{"NUM":0}},"block":{"type":"blockVariableGetValue","id":"y67~N-RFiX7DWGtd,EC]","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"W.U@fMet*]=Xg$,uMT|5","fields":{"VAR":{"id":"7)~un:z)5e}=.]Wk?bCp","name":"train","type":"Any"}}}}}}},"ARG1":{"shadow":{"type":"blockMathNumber","id":"f$4d-]=hNJZ9XhAm?bHN","fields":{"NUM":0}},"block":{"type":"blockTextLiteral","id":"JJZ*|pe]Eh0v}Src(wdN","fields":{"TEXT":"horn"}}}}}}},"next":{"block":{"type":"blockComment","id":"dm`WG!80OhNXF:u5!TFK","fields":{"FIELDNAME":"Update the hub and train light to match the brick color."},"next":{"block":{"type":"blockLightOnColor","id":"T*$sZN+bri?yD$om#Qyd","extraState":{"optionLevel":1},"fields":{"METHOD":"LIGHT_ON"},"inputs":{"VAR":{"shadow":{"type":"variables_get_color_light_device","id":"oIc12/y?-Ce;N{gEAUZa","fields":{"VAR":{"id":"9n@^uaL3hZ06|6JvH*6N","name":"hub","type":"EssentialHub"}}}},"COLOR":{"shadow":{"type":"variables_get_color","id":"v+wSjov.Sdr9:_Skf/:(","fields":{"COLOUR":"#ff0000","VAR":{"id":"omF5^C?F|_S2U^]Da5WM","name":"red","type":"ColorDef"}}},"block":{"type":"blockVariableGetValue","id":"A~R(@uf{0w$Vz`feVyg#","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"y6-/O4((u2NQo{.T5uQh","fields":{"VAR":{"id":"zU|zw|^jx16lQDrMxQ!}","name":"current color","type":"Any"}}}}}}}},"next":{"block":{"type":"blockImportTaskCallStatement","id":"[y/$X*mA@e{8[TCgMZq5","extraState":{"optionLevel":2},"inputs":{"VAR":{"shadow":{"type":"variables_get_imported_function","id":"Ydl);J;Q0vF7h1I/7+kd","fields":{"VAR":{"id":"H)(CPxdW.NkK~=wz;ku{","name":"set_light","type":"FunctionImported"}}}},"ARG0":{"shadow":{"type":"blockMathNumber","id":"e|87I,cMCG3/a?#7g|qT","fields":{"NUM":0}},"block":{"type":"blockVariableGetValue","id":"C3-d*/h;X#^/3p[sF6lz","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"E*Gqx3.c|5mdS}VMz*{)","fields":{"VAR":{"id":"7)~un:z)5e}=.]Wk?bCp","name":"train","type":"Any"}}}}}}},"ARG1":{"shadow":{"type":"blockMathNumber","id":"f$4d-]=hNJZ9XhAm?bHN","fields":{"NUM":0}},"block":{"type":"blockVariableGetValue","id":"D$6^rfF27b(bHNHj3Nmk","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"FgNhUf~Z*2EjfB2!Zn%a","fields":{"VAR":{"id":"zU|zw|^jx16lQDrMxQ!}","name":"current color","type":"Any"}}}}}}}},"next":{"block":{"type":"blockVariableSetValue","id":"=nQ:3DtV!BN0nxtFl?PV","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"DW`wY+v=k!@d[)@8%I32","fields":{"VAR":{"id":"TE4wo///`0hS0R{cxKph","name":"last color","type":"Any"}}}},"VALUE0":{"shadow":{"type":"blockMathNumber","id":"/JAYKeF3K;u/uWU/(^N_","fields":{"NUM":0}},"block":{"type":"blockVariableGetValue","id":"aXZUDt$ho^iQ)(%/nHJ=","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"=q|s2gp7Bf?Pb+qtN$5z","fields":{"VAR":{"id":"zU|zw|^jx16lQDrMxQ!}","name":"current color","type":"Any"}}}}}}}}}}}}}}}}}}}}},"next":{"block":{"type":"blockComment","id":"KW3S)7[n{X/r,=1LhFQI","fields":{"FIELDNAME":"Play a sound if the hub button is pressed."},"next":{"block":{"type":"blockIfElse","id":"v)^9}@2LrGx`b|I4dK~v","extraState":{"optionLevel":0},"inputs":{"IF0":{"shadow":{"type":"blockLogicTrue","id":"zI0~8[`K2E?PqjnS*1o8"},"block":{"type":"blockButtonIsPressed","id":"=Yr:J3Co*%D|AYy-:cZQ","inputs":{"VAR":{"shadow":{"type":"variables_get_keypad","id":"aXy%S3*+fY.oF#1j@ZUA","fields":{"VAR":{"id":"9n@^uaL3hZ06|6JvH*6N","name":"hub","type":"EssentialHub"}}}},"VALUE0":{"shadow":{"type":"blockParametersButton","id":"[p#wDekt^|~_$x{/VV*h","fields":{"VALUE":"CENTER"}}}}}},"DO0":{"block":{"type":"blockImportTaskCallStatement","id":"n$-RekZ{=^Cr-,smU#8?","extraState":{"optionLevel":2},"inputs":{"VAR":{"shadow":{"type":"variables_get_imported_function","id":"{nG?[vNSEQ.AX+{A$%r%","fields":{"VAR":{"id":"InaCEX!Wvubx{)h9ua7L","name":"play_sound","type":"FunctionImported"}}}},"ARG0":{"shadow":{"type":"blockMathNumber","id":"k*kN}}Ni!gyWAr#OsKen","fields":{"NUM":50}},"block":{"type":"blockVariableGetValue","id":"{zaWnV+o$.e$z=AQB`rT","inputs":{"VAR":{"shadow":{"type":"variables_get_any","id":"a|cXV.~[IiS?f[:JGmVA","fields":{"VAR":{"id":"7)~un:z)5e}=.]Wk?bCp","name":"train","type":"Any"}}}}}}},"ARG1":{"shadow":{"type":"blockMathNumber","id":"B%d#N@tor?Fdx;7!2uYP","fields":{"NUM":0}},"block":{"type":"blockTextLiteral","id":"])tK^}]`!$YeGCh-HG4;","fields":{"TEXT":"depart"}}}},"next":{"block":{"type":"blockWaitUntil","id":"%CH{0LJ5NU-#wL)rBnOE","inputs":{"BOOL":{"shadow":{"type":"blockLogicTrue","id":"f!B]ND?BM^EcCiOCs0k,"},"block":{"type":"blockLogicIsNone","id":"vs*d88oa_V-HhQI1-F;N","fields":{"OP":"NOT"},"inputs":{"BOOL":{"shadow":{"type":"blockLogicTrue","id":"O5)5@ZgrGO^u7^@:o[7O"},"block":{"type":"blockButtonIsPressed","id":"CMj05}Z/{EB*N|oKYD8$","inputs":{"VAR":{"shadow":{"type":"variables_get_keypad","id":"~afpS]ef6Ym0_tlyxsLr","fields":{"VAR":{"id":"9n@^uaL3hZ06|6JvH*6N","name":"hub","type":"EssentialHub"}}}},"VALUE0":{"shadow":{"type":"blockParametersButton","id":"9]%9@7g)h-`Fc$:7iu9/","fields":{"VALUE":"CENTER"}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}]},"variables":[{"name":"red","id":"omF5^C?F|_S2U^]Da5WM","type":"ColorDef"},{"name":"orange","id":"c4B}9l^;G*zq3ivTVEeO","type":"ColorDef"},{"name":"yellow","id":"X{5Y-Em{$l`HC{[4_/*Q","type":"ColorDef"},{"name":"green","id":"]dSoqm%[m9g2|lcZ?Vt%","type":"ColorDef"},{"name":"cyan","id":"g3Twx:Qh[n8zecY^e,:}","type":"ColorDef"},{"name":"blue","id":"m(z^qpO7D5BW9tz26|Pf","type":"ColorDef"},{"name":"violet","id":"Y{?!s3Ht.4,JX]Pn4{3d","type":"ColorDef"},{"name":"magenta","id":"P#0lFve(w}KW!j_+.q{w","type":"ColorDef"},{"name":"white","id":"a%.-R]L(`w^(o=AEt]K`","type":"ColorDef"},{"name":"none","id":"TFmFW?).wKf=+rwisHES","type":"ColorDef"},{"name":"color sensor","id":"@XZHI/7H?CTN~buGAy24","type":"ColorSensor"},{"name":"duplo","id":"675Tewb-hZRNskTpaPR^","type":"ModuleImported"},{"name":"dial","id":"A%Q4I{Fw1}[HZ25D/7sC","type":"Motor"},{"name":"start_driving","id":"NdzekE#*A-3^u{=XF,9y","type":"FunctionImported"},{"name":"play_sound","id":"InaCEX!Wvubx{)h9ua7L","type":"FunctionImported"},{"name":"DuploTrain","id":"Sffa}}200*Q_|`ua!5IE","type":"FunctionImported"},{"name":"set_light","id":"H)(CPxdW.NkK~=wz;ku{","type":"FunctionImported"},{"name":"hub","id":"9n@^uaL3hZ06|6JvH*6N","type":"EssentialHub"},{"name":"last color","id":"TE4wo///`0hS0R{cxKph","type":"Any"},{"name":"current color","id":"zU|zw|^jx16lQDrMxQ!}","type":"Any"},{"name":"train","id":"7)~un:z)5e}=.]Wk?bCp","type":"Any"},{"name":"city hub","id":"GA,!k6,j?^t#!gQ5U{p?","type":"CityHub"}],"info":{"type":"pybricks","version":"1.2.3"}}
from pybricks.hubs import EssentialHub
from pybricks.parameters import Button, Color, Direction, Port
from pybricks.pupdevices import ColorSensor, Motor
from pybricks.tools import wait

from duplo import DuploTrain, play_sound, set_light, start_driving

# Set up all devices.
hub = EssentialHub()
color_sensor = ColorSensor(Port.B)
dial = Motor(Port.A, Direction.CLOCKWISE)

# Initialize variables.
train = DuploTrain()
last_color = Color.NONE
current_color = Color.NONE


# The main program starts here.
# My youngest would often press the hub button. This
# normally stops the program, so it interrupts the fun
# of just playing and independently exploring.

# This block disables that, so the program doesn't stop.
# If you do want to stop eventually, just hold the button
# to turn the hub off entirely, as you normally would.
hub.system.set_stop_button(None)
while True:
    # Set the train speed based on the motor angle.
    start_driving(train, dial.angle())
    # Detect colored bricks. Use it to update the duplo light and sound.
    current_color = color_sensor.color()
    # Do something only if the color changed.
    if current_color != last_color:
        # If there is any color (not none), sound the horn.
        if current_color != Color.NONE:
            play_sound(train, 'horn')
        # Update the hub and train light to match the brick color.
        hub.light.on(current_color)
        set_light(train, current_color)
        last_color = current_color
    # Play a sound if the hub button is pressed.
    if Button.CENTER in hub.buttons.pressed():
        play_sound(train, 'depart')
        while Button.CENTER in hub.buttons.pressed():
            wait(1)
